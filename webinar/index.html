<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Вебинар Astellas</title>
    <link rel="stylesheet" href="fonts/fonts.css">
    <link rel="stylesheet" href="css/main.css">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/starter-template.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>

<div class="header">
    <img src="img/logo.svg" alt="" class="head-content__logo">
    <div class="header__text">
        Алгоритм диагностики и&nbsp;терапии симптомов нарушенного мочеиспускания
    </div>
</div>
<div class="content">
    <div class="video">
        <div id="video-block-1" class="video-responsive">
            <div class="video-frame">
                <iframe id="iframe-1" class="iframe"
                        src="https://player.vimeo.com/video/321711168"
                        frameborder="0"
                        allowFullScreen
                        mozallowfullscreen
                        webkitAllowFullScreen
                ></iframe>


            </div>


        </div>

        <div id="video-block-2" class="video-responsive" style="display: none">
            <div class="video-frame">
                <iframe id="iframe-2" class="iframe"
                        src="https://player.vimeo.com/video/321711204"
                        frameborder="0"
                        allowFullScreen
                        mozallowfullscreen
                        webkitAllowFullScreen
                ></iframe>
            </div>

            <div id = "survey_block_2" class="survey">
                <div class="survey__text">Спасибо за просмотр! Пожалуйста, пройдите короткий опрос:</div>
                <div class="js-button-survey survey__button" data-video="2">
                    <div class="survey__button__img"></div>
                    <div class="survey__button__text">
                        Начать&nbsp;опрос
                    </div>
                </div>
            </div>

        </div>

        <div id="video-block-3" class="video-responsive" style="display: none">
            <div class="video-frame">
                <iframe id="iframe-3" class="iframe"
                        src="https://player.vimeo.com/video/325002316"
                        frameborder="0"
                        allowFullScreen
                        mozallowfullscreen
                        webkitAllowFullScreen
                ></iframe>
            </div>

        </div>

        <div id="video-block-4" class="video-responsive" style="display: none">
            <div class="video-frame">
                <iframe id="iframe-4" class="iframe"
                        src="https://player.vimeo.com/video/328602024"
                        frameborder="0"
                        allowFullScreen
                        mozallowfullscreen
                        webkitAllowFullScreen
                ></iframe>
            </div>

            <div id = "survey_block_4" class="survey">
                <div class="survey__text">Спасибо за просмотр! Пожалуйста, пройдите короткий опрос:</div>
                <div class="js-button-survey survey__button" data-video="4">
                    <div class="survey__button__img"></div>
                    <div class="survey__button__text">
                        Начать&nbsp;опрос
                    </div>
                </div>
            </div>

        </div>

        <div class="video__block">
            <div class="video-list">
                <div class="video-list__item active available" data-iframe="1" data-player = "webinar_announce_balan">
                    <div class="video__img"></div>
                    <div class="video__content">
                        <div class="video__name">Анонс вебинара (Балан В.Э.)</div>
                        <div class="video__info">
                            <div class="video__time">0:39</div>
                            <div class="video__status">Не просмотрено</div>
                        </div>

                    </div>
                </div>
                <div class="video-list__item" data-iframe="2" data-player = "diagnostic_algorithm">
                    <div class="video__img"></div>
                    <div class="video__content">
                        <div class="video__name">Алгоритм диагностики и терапии симптомов нарушенного мочеиспускания
                            (часть 1)
                        </div>
                        <div class="video__info">
                            <div class="video__status_none">Видео будет доступно позднее</div>
                        </div>

                    </div>
                </div>
                <div class="video-list__item" data-iframe="3" data-player = "webinar_announce_patients">
                    <div class="video__img"></div>
                    <div class="video__content">
                        <div class="video__name">Анонс вебинара (пациенты)</div>
                        <div class="video__info">
                            <div class="video__status_none">Видео будет доступно позднее</div>
                        </div>

                    </div>
                </div>
                <div class="video-list__item" data-iframe="4" data-player = "diagnostic_algorithm_2">
                    <div class="video__img"></div>
                    <div class="video__content">
                        <div class="video__name">Алгоритм диагностики и терапии симптомов нарушенного мочеиспускания (часть 2)</div>
                        <div class="video__info">
                            <div class="video__status_none">Видео будет доступно позднее</div>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="form">
        <div class="head-content">
            Задайте ваш вопрос
        </div>
        <div class="question">
            <input type="radio" name="question" value="var1" id="q1"><label for="q1" class="js-question question__choice question__choice--left active">Задать вопрос компании Astellas</label>
            <input type="radio" name="question" value="var2" id="q2"><label for="q2" class="js-question question__choice question__choice--right">Задать вопрос Вере Ефимовне Балан</label>
        </div>
        <div class="form__fields">
            <div class="form__field form__field--half surname">
                <input id="surname" class="js-check js-input input" type="text" autocomplete="off">
                <div class="form__field-placeholder">Фамилия</div>
                <img src="img/bx-info-circle.svg" class="info-circle">
            </div>
            <div class="form__field form__field--half name">
                <input id="name" class="js-check js-input input" type="text" autocomplete="off">
                <div class="form__field-placeholder">Имя</div>
                <img src="img/bx-info-circle.svg" class="info-circle">
            </div>
            <div class="form__field email">
                <input id="email" class="js-check js-input input" type="text" autocomplete="off">
                <div class="form__field-placeholder">E-mail</div>
                <img src="img/bx-info-circle.svg" class="info-circle">
            </div>
            <div class="form__field message text">
                <textarea id="text" class="js-check js-input input textarea"></textarea>
                <div class="form__field-placeholder">Введите текст вопроса</div>
                <img src="img/bx-info-circle.svg" class="info-circle">
            </div>
            <div class="agreement agree">
                <input id="agreement" class="js-check checkbox" type="checkbox">
                <label for="agreement" class="label">Я согласен (-сна) с правилами сбора и хранения персональных
                    данных</label>
                <img src="img/bx-info-circle.svg" class="info-circle">
            </div>
            <button class="js-send send selected">
                <img src="img/send.svg" alt="" class="send__image">
                <span class="send__text">Отправить</span>
            </button>
            <div class="repeat-question">
                <button class="thanks">
                    <img src="img/pink-fly.svg" alt="" class="thanks__image">
                    <span class="thanks__text">Спасибо! Ваш вопрос отправлен</span>
                </button>
                <button class="js-plus one-plus">
                    <img src="img/bx-plus-circle.svg" alt="" class="one-plus__img">
                    <div class="one-plus__text">Задать ещё один</div>
                </button>
            </div>

        </div>

    </div>


    <div class="head-content">
        Экспертный совет
    </div>
    <div class="professor">
        <div class="professor__content">
            <div class="professor__position">
                Руководитель программы
            </div>
            <div class="professor__name">
                Вера Ефимовна Балан
            </div>
            <div class="professor__description">
                Д. м. н., профессор, гинеколог- эндокринолог, врач высшей категории, руководитель
                поликлинического отделения
                МОНИИАГ, президент Российской ассоциации по менопаузе
            </div>
        </div>
    </div>

</div>
<!--<div id="video-1" class="survey-wrapper">-->
    <!--<div class="survey-block">-->
        <!--<div class="questions">-->
            <!--<div class="questions__question">-->
                <!--<div class="questions__header">Оцените, насколько вебинар был полезен:</div>-->
                <!--<div class="scale">-->
                    <!--<div class="scale__block">-->
                        <!--<div class="scale__line scale__line&#45;&#45;first"></div>-->
                        <!--<div class="scale__circles">-->
                            <!--<div class="js-scale scale__circle"><span class="number">1</span></div>-->
                            <!--<div class="js-scale scale__circle"><span class="number">2</span></div>-->
                            <!--<div class="js-scale scale__circle"><span class="number">3</span></div>-->
                            <!--<div class="js-scale scale__circle"><span class="number">4</span></div>-->
                            <!--<div class="js-scale scale__circle"><span class="number">5</span></div>-->
                        <!--</div>-->
                    <!--</div>-->
                    <!--<div class="scale__block">-->
                        <!--<div class="scale__line"></div>-->
                        <!--<div class="scale__circles">-->
                            <!--<div class="js-scale scale__circle"><span class="number">6</span></div>-->
                            <!--<div class="js-scale scale__circle"><span class="number">7</span></div>-->
                            <!--<div class="js-scale scale__circle"><span class="number">8</span></div>-->
                            <!--<div class="js-scale scale__circle"><span class="number">9</span></div>-->
                            <!--<div class="js-scale scale__circle"><span class="number">10</span></div>-->
                        <!--</div>-->
                    <!--</div>-->

                <!--</div>-->
            <!--</div>-->
            <!--<div class="questions__question">-->
                <!--<div class="questions__header">Есть ли у вас пациенты с ГМП? </div>-->
                <!--<div class="answers" data-answer="1">-->
                    <!--<div class="js-answer answers__answer answers__answer&#45;&#45;left">Да</div>-->
                    <!--<div class="js-answer answers__answer answers__answer&#45;&#45;right">Нет</div>-->
                <!--</div>-->
            <!--</div>-->
            <!--<div class="questions__question">-->
                <!--<div class="questions__header">Будете ли вы самостоятельно лечить пациентов с ГМП?</div>-->
                <!--<div class="answers" data-answer="2">-->
                    <!--<div class="js-answer answers__answer answers__answer&#45;&#45;left">Да</div>-->
                    <!--<div class="js-answer answers__answer answers__answer&#45;&#45;right">Направлю к урологу</div>-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->
        <!--<div class="js-button-survey-close survey__button survey__button&#45;&#45;close">-->
            <!--<div class="survey__button__img"></div>-->
            <!--<div class=" survey__button__text">-->
                <!--Завершить&nbsp;опрос-->
            <!--</div>-->
        <!--</div>-->

    <!--</div>-->
<!--</div>-->
<div id="video-2" class="survey-wrapper">
    <div class="survey-block">
        <div class="questions">
            <div class="questions__question">
                <div class="questions__header">Оцените, насколько вебинар был полезен:</div>
                <div class="scale">
                    <div class="scale__block">
                        <div class="scale__line scale__line--first"></div>
                        <div class="scale__circles">
                            <div class="js-scale scale__circle"><span class="number">1</span></div>
                            <div class="js-scale scale__circle"><span class="number">2</span></div>
                            <div class="js-scale scale__circle"><span class="number">3</span></div>
                            <div class="js-scale scale__circle"><span class="number">4</span></div>
                            <div class="js-scale scale__circle"><span class="number">5</span></div>
                        </div>
                    </div>
                    <div class="scale__block">
                        <div class="scale__line"></div>
                        <div class="scale__circles">
                            <div class="js-scale scale__circle"><span class="number">6</span></div>
                            <div class="js-scale scale__circle"><span class="number">7</span></div>
                            <div class="js-scale scale__circle"><span class="number">8</span></div>
                            <div class="js-scale scale__circle"><span class="number">9</span></div>
                            <div class="js-scale scale__circle"><span class="number">10</span></div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="questions__question">
                <div class="questions__header">Есть ли у вас пациенты с ГМП? </div>
                <div class="answers" data-answer="1">
                    <div class="js-answer answers__answer answers__answer--left">Да</div>
                    <div class="js-answer answers__answer answers__answer--right">Нет</div>
                </div>
            </div>
            <div class="questions__question">
                <div class="questions__header">Будете ли вы самостоятельно лечить пациентов с ГМП?</div>
                <div class="answers" data-answer="2">
                    <div class="js-answer answers__answer answers__answer--left">Да</div>
                    <div class="js-answer answers__answer answers__answer--right">Направлю к урологу</div>
                </div>
            </div>
        </div>
        <div class="js-button-survey-close survey__button survey__button--close">
            <div class="survey__button__img"></div>
            <div class=" survey__button__text">
                Завершить&nbsp;опрос
            </div>
        </div>

    </div>
</div>
<div id="video-4" class="survey-wrapper">
    <div class="survey-block">
        <div class="questions">
            <div class="questions__question">
                <div class="questions__header">Оцените, насколько вебинар был полезен:</div>
                <div class="scale">
                    <div class="scale__block">
                        <div class="scale__line scale__line--first"></div>
                        <div class="scale__circles">
                            <div class="js-scale scale__circle"><span class="number">1</span></div>
                            <div class="js-scale scale__circle"><span class="number">2</span></div>
                            <div class="js-scale scale__circle"><span class="number">3</span></div>
                            <div class="js-scale scale__circle"><span class="number">4</span></div>
                            <div class="js-scale scale__circle"><span class="number">5</span></div>
                        </div>
                    </div>
                    <div class="scale__block">
                        <div class="scale__line"></div>
                        <div class="scale__circles">
                            <div class="js-scale scale__circle"><span class="number">6</span></div>
                            <div class="js-scale scale__circle"><span class="number">7</span></div>
                            <div class="js-scale scale__circle"><span class="number">8</span></div>
                            <div class="js-scale scale__circle"><span class="number">9</span></div>
                            <div class="js-scale scale__circle"><span class="number">10</span></div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="questions__question">
                <div class="questions__header">Есть ли у вас пациенты с ГМП? </div>
                <div class="answers" data-answer="1">
                    <div class="js-answer answers__answer answers__answer--left">Да</div>
                    <div class="js-answer answers__answer answers__answer--right">Нет</div>
                </div>
            </div>
            <div class="questions__question">
                <div class="questions__header">Будете ли использовать данный алгоритм лечения для пациентов с ГМП?</div>
                <div class="answers" data-answer="2">
                    <div class="js-answer answers__answer answers__answer--left">Да</div>
                    <div class="js-answer answers__answer answers__answer--right">Направлю к урологу</div>
                </div>
            </div>
        </div>
        <div class="js-button-survey-close survey__button survey__button--close">
            <div class="survey__button__img"></div>
            <div class=" survey__button__text">
                Завершить&nbsp;опрос
            </div>
        </div>

    </div>
</div>
<!-- <script src="js/jquery-2.1.4.min.js"></script> -->
<script src="js/slideAppLib.js"></script>
<script src="js/communicate.js"></script>
<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/bootstrap.bundle.min.js" ></script>
<script src="https://player.vimeo.com/api/player.js"></script>
<script>
    var iframe = $('#iframe-1');
    var player = new Vimeo.Player(iframe);
    player.id = 'webinar_announce_balan';

    var iframe2 = $('#iframe-2');
    var player2 = new Vimeo.Player(iframe2);
    player2.id = 'diagnostic_algorithm';

    var iframe3 = $('#iframe-3');
    var player3 = new Vimeo.Player(iframe3);
    player3.id = 'webinar_announce_patients';

    var iframe4 = $('#iframe-4');
    var player4 = new Vimeo.Player(iframe4);
    player4.id = 'diagnostic_algorithm_2';

    var page = {
        players: [],
        surveys: {},
        forms: [],
        hash: undefined,
        AddFormFields: function(formId, data){
            var id = this.forms.length + 1;
            // var arr = this.forms.filter(item=> item.formId == formId);
            // if (arr.length == 0)
            // {
                this.forms.push({ id: id, formId: formId,  data: data });
            // }else{
            //     arr[0].formId = formId;
            //     arr[0].data = data;
            // }
        },
        AddDataPlayer: function(playerId, data){
                var id = this.players.length + 1;
                var arr = this.players.filter(item=> item.playerId == playerId);
                if (arr.length == 0)
                {
                    this.players.push({ id: id, playerId: playerId,  timerline: data });
                }else{
                    arr[0].playerId = playerId;
                    arr[0].timerline = data;
                }
        },
        GetSurvayAnswers: function(){
            var SurvayList = [];
            var survayNumber = 0;

            $('.survey-block').each(function() {
                var Survay = {
                    survay: survayNumber++,
                    answers: []
                };

                $(this).find('.questions__question').each(function() {
                    Survay.answers.push({
                        question: $(this).find('.questions__header').text(),
                        answer: $(this).find('.active').text()
                    });
                });
                SurvayList.push(Survay);
            });
            return SurvayList;
        },

        RefreshSurveys: function(){
            this.surveys = this.GetSurvayAnswers();
            this.SendData();
            this.Test();
        },
        Test: function(){
            var obj = { StringData: String(JSON.stringify(this))};
            console.log(JSON.stringify(obj));
        },
        SendData: function(){
                if(!!this.hash || this.hash != ""){
                    var data = { StringData: String(JSON.stringify(this))};
                    $.ajax({
                        url: 'https://ocm-dispatcher.astellas-mdm.ru/real/api/watch/video/' + this.hash,
                        type: 'POST',
                        data: JSON.stringify(data),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        async: true,
                        success: function(msg) {
                            //console.log(msg);
                        }
                    });
                }
        },
        GetHash: function(){
            this.hash = this.GetQueryParam('utm_source');
            return this.hash;
        },
        GetQueryParam: function (param) {
            var queries = window.location.search, regex, resRegex, results, response;
            param = encodeURIComponent(param);
            regex = new RegExp('[\\?&]' + param + '=([^&#]*)', 'g');
            resRegex = new RegExp('(.*)=([^&#]*)');
            results = queries.match(regex);
            if (!results) {
                return '';
            }
            response = results.map(function (result) {
                var parsed = resRegex.exec(result);
                if (!parsed) {
                    return '';
                }
                return parsed[2].match(/(^\d+$)/) ? Number(parsed[2]) : parsed[2];
            });
            return response.length > 1 ? response : response[0];
        },
        SetEventParam: function(playerId, eventName){
            if(getCookie(playerId) == ""){
                setCookie(playerId, '{}', 7)
            }
            if(getCookie(playerId) != ""){
                var setting = JSON.parse(getCookie(playerId));
                if(!("events" in setting)){
                  console.log("eventes is exist. Create");
                  setting.events = [];
  				}
                if("events" in setting){
                  console.log("eventes is exist");
                    var id = setting.events.length + 1;
                    var arr = setting.events.filter(item=> item.name == eventName);
                    if (arr.length == 0)
                    {
                        setting.events.push({ id: id, name: eventName,  value: true });
                    }else{
                        arr[0].name = eventName;
                        arr[0].value = true;
                    }
                    setCookie(playerId, String(JSON.stringify(setting)), 7)
                }
            }
        },
        GetEventParam: function(playerId, eventName){
            if(getCookie(playerId) != ""){
                setting = JSON.parse(getCookie(playerId));
                if("events" in setting){
                    var arr = setting.events.filter(item=> item.name == eventName);
                    if (arr.length != 0)
                    {
                        return arr[0].value;
                    }
                }
            }
        }

    };

    page.GetHash();
    var timerId = setInterval(function() {
        page.RefreshSurveys();
        RefreshStatusVideo();
    }, 2000);


    player.on('timeupdate', function(data) {
        page.AddDataPlayer(player.id , data);
        EventTimeManager(player.id, data);
        page.SendData();
    });

    player2.on('timeupdate', function(data) {
        page.AddDataPlayer(player2.id , data);
        EventTimeManager(player2.id, data);
        page.SendData();
    });

    player3.on('timeupdate', function(data) {
        page.AddDataPlayer(player3.id , data);
        EventTimeManager(player3.id, data);
        page.SendData();
    });

    player4.on('timeupdate', function(data) {
        page.AddDataPlayer(player4.id , data);
        EventTimeManager(player4.id, data);
        page.SendData();
    });


    function RefreshStatusVideo(){
        $('.video-list__item').each(function(i, el) {
            var playerId = $(el).attr('data-player');
            if(page.GetEventParam(playerId, 'TheEndVideo')){
                $(el).find('.video__status').html('Просмотрено');
            }else{
                $(el).find('.video__status').html('Не просмотрено');
            }
        });
    }

    var EventTime = [
            { playerId: player.id, seconds: 38, func: "IsTheEndVideo_playerId_1()", eventName: 'TheEndVideo', isNow: false },
            { playerId: player2.id, seconds: 63, func: "IsTheEndVideo_playerId_2()", eventName: 'TheEndVideo', isNow: false },
            { playerId: player3.id, seconds: 1300, func: "IsTheEndVideo_playerId_3()", eventName: 'TheEndVideo', isNow: false },
            { playerId: player4.id, seconds: 1080, func: "IsTheEndVideo_playerId_4()", eventName: 'TheEndVideo', isNow: false }
        ];

    function EventTimeManager(playerId , data)
    {
        $.each(EventTime, function(index, eventFunc) {
            if(playerId == eventFunc.playerId){
                if(Math.ceil(data.seconds) == eventFunc.seconds && eventFunc.isNow == false){
                    eventFunc.isNow = true;
                    eval(eventFunc.func);
                    page.SetEventParam(playerId, eventFunc.eventName);
                }

                if(Math.ceil(data.seconds) != eventFunc.seconds)
                {
                    eventFunc.isNow = false;
                }
            }
        });

    }

    function IsTheEndVideo_playerId_1()
    {
        // $("#survey_block_1").addClass('active');
        // $('.video-frame').css('pointer-events', 'none');
    }
    function IsTheEndVideo_playerId_2()
    {
        $("#survey_block_2").addClass('active');
    }

    function IsTheEndVideo_playerId_3()
    {
        // alert('IsTheEndVideo_playerId_3');
    }

    function IsTheEndVideo_playerId_4()
    {
        $("#survey_block_4").addClass('active');
    }


    let answers = {
        '1': [false, false, false],
        '2': [false, false, false],
        '3': [false, false, false],
        '4': [false, false, false]
    };


    let chosen = false;
    let current;

    let closeSurvey = $('.js-button-survey-close'),
        surveyWrapper = $('.survey-wrapper');

    let form = {
        name: '',
        surname: '',
        email: '',
        text: '',
        agree: '',
        questionTo: 'Задать вопрос компании Astellas'
    };


    function checkAnswers() {
        let trueAnswers = 0;
        for (let i = 0; i < answers[current].length; i++) {
            if (answers[current][i] === true) {
                trueAnswers += 1;
            }
        }
        if (trueAnswers === 3) {
            chosen = true;
            $(`#video-${current} .js-button-survey-close`).addClass('active');
        }
    }

    function validate(val) {
        let re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return(re.test(String(val).toLowerCase()));
    }

    function checkForm() {
        let filledFields = 0;
        let counter = 0;
        for (let keys in form) {
            counter++;
            if (form[keys].length !== 0) {
                $(`.${keys}`).addClass('filled').removeClass('unfilled');
                filledFields += 1;
            }
            else {
                $(`.${keys}`).removeClass('filled');
                filledFields -= 1;
            }
        }
        if (filledFields !== counter) {
            $('.js-send').removeClass('active');
            $('.send__image').attr('src', 'img/send.svg');
        }
        else if (filledFields === counter) {
            $('.js-send').removeAttr('disabled').addClass('active');
            $('.send__image').attr('src', 'img/unblock.svg');
        }
    }
    function addFilledQuestion() {
        let arr = [];
        for (let keys in form) {
            arr.push(form[keys])
        }
        page.AddFormFields(1, form);
    }

    $('.js-send').on('touchstart click', function() {
        $('.js-check').each(function(i, el) {
            if (!$(el).parent().hasClass('filled')) {
                $(el).parent().addClass('unfilled');
            }
        });
        if ($(this).hasClass('active')) {
            $(this).removeClass('selected');
            $('.repeat-question').addClass('selected');
            addFilledQuestion();
        }

    });

    $('.js-plus').on('touchend click', function() {
        $('.repeat-question').removeClass('selected');
        $('.js-send').addClass('selected').removeClass('active');
        $('#text').val('');
        $('.send__image').attr('src', 'img/send.svg');

    });

    $('.js-button-survey').on('touchend click', function() {
        current = $(this).attr('data-video');
        surveyWrapper.removeClass('active');
        $(`#video-${current}`).addClass('active');
        player.pause();
        player2.pause();
        player3.pause();
        player4.pause();
    });

    closeSurvey.on('touchend click', ()=> {
       if (chosen) {
           surveyWrapper.removeClass('active');
       }
    });

    $('.js-input').on('input', function() {
        $(this).next().addClass('active');
        let val = $(this).val();

        let id = $(this).attr('id');
        if (id === 'email') {
            if (validate(val)) {
                form[id] = val;
            }
            else {
                form[id] = '';
            }
        }
        else form[id] = val;

        checkForm();

        console.log(form);
    });
    $('#agreement').on('change', function() {
        if (this.checked) {
            form.agree = 'true';
        }
        else form.agree = '';
        checkForm();
    });

    $('.js-answer').on('touchend click', function() {
        let index = $(this).parent().attr('data-answer');
        $(this).parent().find('.js-answer').removeClass('active');
        $(this).addClass('active');
        answers[current][+index] = true;
        checkAnswers();
    });

    $('.js-scale').on('touchend click', function() {
        $('.js-scale').removeClass('active');
        $(this).addClass('active');
        answers[current][0] = true;
        checkAnswers()
    });

    $('.js-question').on('touchend click', function() {
        $('.js-question').removeClass('active');
        $(this).addClass('active');
        form.questionTo = $(this).text();
    });

    let videoButtons =  $('.available');
    videoButtons.on('touchend click', function() {
        videoButtons.removeClass('active');
        $(this).addClass('active');
        let iframe = $(this).attr('data-iframe');
        $('.video-responsive').css('display', 'none');
        $(`#video-block-${iframe}`).css('display', 'block');
    });


function setCookie(cname, cvalue, exdays) {
  var d = new Date();
  d.setTime(d.getTime() + (exdays*24*60*60*1000));
  var expires = "expires="+ d.toUTCString();
  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

function getCookie(cname) {
  var name = cname + "=";
  var decodedCookie = decodeURIComponent(document.cookie);
  var ca = decodedCookie.split(';');
  for(var i = 0; i <ca.length; i++) {
    var c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}

</script>
</body>
</html>